# compiler-workout

Supplementary repository for compiler course.

Prerequisites: ocaml [http://ocaml.org], opam [http://opam.ocaml.org].

Building:

* `opam pin add GT https://github.com/dboulytchev/GT.git`
* `opam pin add ostap https://github.com/dboulytchev/ostap.git`
* `opam install ostap`
* `opam install GT`
* To build the sources: `make` from the top project directory
* To test: `test.sh` from `regression` subfolder



### Про бенчмарки

Было рассмотрено три подхода к созданию синтаксического анализатора:

* LR анализ на основе Menhir
* Нисходящий с помощью библиотеки Opal
* Нисходящий с помощью Ostap

#### Сравнение производительности

Сравнивались три реализации:

* Старый[https://github.com/Kakadu/ostap/tree/master-very-old] Ostap с отключенной обработкой ошибок
* Opal[https://github.com/pyrocat101/opal]
* Menhir[http://gitlab.inria.fr/fpottier/menhir]

Opal не поддерживает человеческие сообщения об ошибках, поэтому в Ostap те были отключены. В Menhir сообщения об
ошибках так просто отключить нельзя.

Производительность показана в таблице. Парсеры запускали в течение 1 секунды и вычислялось сколько раз они успешно отработали. В таблице хранится следующая информация:

* Первый столбец -- название парсера
* Второй столбей -- абсолютная скорость, чем больше, тем лучше
* Третий -- таблица ускорения одного вида парсинга относительно другого. Для строки L и стобца R в ячейке `[L][R]` будет храниться ускроение, которое дает парсер L относительно R, которое вычисляется как (L-R)/R*100%. В зеркальных элементах таблицы при  таком подсчете будут всегда значения противоположного знака.

В итоге получилось, что LR анализатор (Menhir) работает существенно производительнее нисходящего анализа, по причинам...

#### Сравнение размера кода

Реализации находятся в файлах

* LamaOpal.ml
* LamaOstapP5.ml
* LamaMenhir.mly и LamaLexer.mll

Ostap использует специальное синтаксическое расширение для написание парсера, поэтому естесственно, что размер реализации на Ostap меньше, чем на Opal. Но и там, и там, можно описывать специализированные парсеры (например, парсер арифметических выражений), использование которых может сделать код более похожим по размеру.

Menhir позволяет параметризовывать правила другими, в том числе "анонимными" правилами, поддерживает специальный синтаксии для операций EBNF. Поэтому размер непосредственно пасрера можно сопоставить по размеру с реализацией на Ostap, за несколькими исключениями.

* Ostap использует специальный парсер для парсинга арифметических выражений, поэтому эта часть на нём компактнее.
* Menhir использует lexer на основе OCamlLex, в Ostap это реализовано по-другому. Поэтому реализация лексической части на menhir выглядит сущетсвенно длиннее, чем на Ostap.

#### Разбираемый язык

Разновиность Ламы, где мы не используем определение кастомных инфиксных операторов. По идее, если их завести, то menhir будет больно. ДЮ, вы тут лучше знаете, какие там инфиксы в Ламе и почему именно будет больно.
